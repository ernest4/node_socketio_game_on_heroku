<!DOCTYPE html>
<html>
    
    <!-- Copyright 2018 Ernestas Monkevicius -->

    <head>
        <meta charset="utf-8">
    </head>

    <body>
        <script src="/socket.io/socket.io.js"></script>
        <script src="//cdn.jsdelivr.net/npm/phaser@3.3.0/dist/phaser.min.js"></script>
        <script src="js/game.js"></script>

        <p id="message"></p>
        <p id="version">v0.0.1</p>
        <button type="button" id="saveBtn">Save to DB</button>

        <script src="https://code.jquery.com/jquery-1.11.1.js"></script>
        <script>
        $(function () {
            // var socket = io();

            // socket.on('savedToDB', function(data){
            //     console.log(data); //TESTING
                
            //     $('#message').text(data);
            // });

            // $('#saveBtn').on('click', function(){
            //     socket.emit('saveToDB');
            // });

            //var socket = new WebSocket('wss://echo.websocket.org');
            var HOST = location.origin.replace(/^http/, 'ws');
            var socket = new WebSocket(HOST);
            socket.binaryType = 'arraybuffer';

            socket.onopen = function(event) {
                console.log(`Connection established`);

                socket.send('Client says hi');

                //socket.close();
            };

            socket.onmessage = function(event){
                console.log(`response: ${event.data}`);

                // if(typeOf (event.data) === String ){
                //     //create a JSON object
                //     var jsonObject = JSON.parse(event.data);
                //     var username = jsonObject.name;
                //     var message = jsonObject.message;
                        
                //     console.log('Received data string');
                // }

                if(event.data instanceof ArrayBuffer){
                    var buffer = event.data;
                    console.log('Received arraybuffer');
                    console.log(new Int8Array(buffer));

                    socket.send(buffer);
                }
            };

            socket.onclose = function (event) {
            // Connection closed.
            // Firstly, check the reason.
                
                if (event.code != 1000) {
                    // Error code 1000 means that the connection was closed normally.

                    // Try to reconnect code here....
                        
                    if (!navigator.onLine) {
                        console.log("You are offline. Please connect to the Internet and try again.");
                    }
                }
                
                console.log('Connection closed.');
            };

            socket.onerror = function(event) {
                console.log(event);
                console.log(`got error: ${event}`);
            };
        });
        </script>
    </body>

</html>
